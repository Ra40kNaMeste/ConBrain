{"version":3,"names":["buildDebug","path","isAsync","loadCodeDefault","supportsESM","fileURLToPath","pathToFileURL","resolve","importMetaResolve","createRequire","existsSync","require","import","meta","url","debug","EXACT_RE","BABEL_PLUGIN_PREFIX_RE","BABEL_PRESET_PREFIX_RE","BABEL_PLUGIN_ORG_RE","BABEL_PRESET_ORG_RE","OTHER_PLUGIN_ORG_RE","OTHER_PRESET_ORG_RE","OTHER_ORG_DEFAULT_RE","resolvePlugin","resolveStandardizedName","bind","resolvePreset","loadPlugin","name","dirname","filepath","value","requireModule","loadPreset","standardizeName","type","isAbsolute","isPreset","replace","resolveAlternativesHelper","standardizedName","error","code","message","oppositeType","transformName","tryRequireResolve","id","paths","tryImportMetaResolve","options","resolveStandardizedNameForRequire","it","res","next","done","resolveStandardizedNameForImport","parentUrl","join","href","resolveESM","resolved","Object","assign","Error","e","e2","err"],"sources":["../../../src/config/files/plugins.ts"],"sourcesContent":["/**\n * This file handles all logic for converting string-based configuration references into loaded objects.\n */\n\nimport buildDebug from \"debug\";\nimport path from \"path\";\nimport type { Handler } from \"gensync\";\nimport { isAsync } from \"../../gensync-utils/async.ts\";\nimport loadCodeDefault, { supportsESM } from \"./module-types.ts\";\nimport { fileURLToPath, pathToFileURL } from \"url\";\n\nimport { resolve as importMetaResolve } from \"../../vendor/import-meta-resolve.js\";\n\nimport { createRequire } from \"module\";\nimport { existsSync } from \"fs\";\nconst require = createRequire(import.meta.url);\n\nconst debug = buildDebug(\"babel:config:loading:files:plugins\");\n\nconst EXACT_RE = /^module:/;\nconst BABEL_PLUGIN_PREFIX_RE = /^(?!@|module:|[^/]+\\/|babel-plugin-)/;\nconst BABEL_PRESET_PREFIX_RE = /^(?!@|module:|[^/]+\\/|babel-preset-)/;\nconst BABEL_PLUGIN_ORG_RE = /^(@babel\\/)(?!plugin-|[^/]+\\/)/;\nconst BABEL_PRESET_ORG_RE = /^(@babel\\/)(?!preset-|[^/]+\\/)/;\nconst OTHER_PLUGIN_ORG_RE =\n  /^(@(?!babel\\/)[^/]+\\/)(?![^/]*babel-plugin(?:-|\\/|$)|[^/]+\\/)/;\nconst OTHER_PRESET_ORG_RE =\n  /^(@(?!babel\\/)[^/]+\\/)(?![^/]*babel-preset(?:-|\\/|$)|[^/]+\\/)/;\nconst OTHER_ORG_DEFAULT_RE = /^(@(?!babel$)[^/]+)$/;\n\nexport const resolvePlugin = resolveStandardizedName.bind(null, \"plugin\");\nexport const resolvePreset = resolveStandardizedName.bind(null, \"preset\");\n\nexport function* loadPlugin(\n  name: string,\n  dirname: string,\n): Handler<{ filepath: string; value: unknown }> {\n  const filepath = resolvePlugin(name, dirname, yield* isAsync());\n\n  const value = yield* requireModule(\"plugin\", filepath);\n  debug(\"Loaded plugin %o from %o.\", name, dirname);\n\n  return { filepath, value };\n}\n\nexport function* loadPreset(\n  name: string,\n  dirname: string,\n): Handler<{ filepath: string; value: unknown }> {\n  const filepath = resolvePreset(name, dirname, yield* isAsync());\n\n  const value = yield* requireModule(\"preset\", filepath);\n\n  debug(\"Loaded preset %o from %o.\", name, dirname);\n\n  return { filepath, value };\n}\n\nfunction standardizeName(type: \"plugin\" | \"preset\", name: string) {\n  // Let absolute and relative paths through.\n  if (path.isAbsolute(name)) return name;\n\n  const isPreset = type === \"preset\";\n\n  return (\n    name\n      // foo -> babel-preset-foo\n      .replace(\n        isPreset ? BABEL_PRESET_PREFIX_RE : BABEL_PLUGIN_PREFIX_RE,\n        `babel-${type}-`,\n      )\n      // @babel/es2015 -> @babel/preset-es2015\n      .replace(\n        isPreset ? BABEL_PRESET_ORG_RE : BABEL_PLUGIN_ORG_RE,\n        `$1${type}-`,\n      )\n      // @foo/mypreset -> @foo/babel-preset-mypreset\n      .replace(\n        isPreset ? OTHER_PRESET_ORG_RE : OTHER_PLUGIN_ORG_RE,\n        `$1babel-${type}-`,\n      )\n      // @foo -> @foo/babel-preset\n      .replace(OTHER_ORG_DEFAULT_RE, `$1/babel-${type}`)\n      // module:mypreset -> mypreset\n      .replace(EXACT_RE, \"\")\n  );\n}\n\ntype Result<T> = { error: Error; value: null } | { error: null; value: T };\n\nfunction* resolveAlternativesHelper(\n  type: \"plugin\" | \"preset\",\n  name: string,\n): Iterator<string, string, Result<string>> {\n  const standardizedName = standardizeName(type, name);\n  const { error, value } = yield standardizedName;\n  if (!error) return value;\n\n  // @ts-expect-error code may not index error\n  if (error.code !== \"MODULE_NOT_FOUND\") throw error;\n\n  if (standardizedName !== name && !(yield name).error) {\n    error.message += `\\n- If you want to resolve \"${name}\", use \"module:${name}\"`;\n  }\n\n  if (!(yield standardizeName(type, \"@babel/\" + name)).error) {\n    error.message += `\\n- Did you mean \"@babel/${name}\"?`;\n  }\n\n  const oppositeType = type === \"preset\" ? \"plugin\" : \"preset\";\n  if (!(yield standardizeName(oppositeType, name)).error) {\n    error.message += `\\n- Did you accidentally pass a ${oppositeType} as a ${type}?`;\n  }\n\n  if (type === \"plugin\") {\n    const transformName = standardizedName.replace(\"-proposal-\", \"-transform-\");\n    if (transformName !== standardizedName && !(yield transformName).error) {\n      error.message += `\\n- Did you mean \"${transformName}\"?`;\n    }\n  }\n\n  error.message += `\\n\nMake sure that all the Babel plugins and presets you are using\nare defined as dependencies or devDependencies in your package.json\nfile. It's possible that the missing plugin is loaded by a preset\nyou are using that forgot to add the plugin to its dependencies: you\ncan workaround this problem by explicitly adding the missing package\nto your top-level package.json.\n`;\n\n  throw error;\n}\n\nfunction tryRequireResolve(\n  id: string,\n  dirname: string | undefined,\n): Result<string> {\n  try {\n    if (dirname) {\n      return { error: null, value: require.resolve(id, { paths: [dirname] }) };\n    } else {\n      return { error: null, value: require.resolve(id) };\n    }\n  } catch (error) {\n    return { error, value: null };\n  }\n}\n\nfunction tryImportMetaResolve(\n  id: Parameters<typeof importMetaResolve>[0],\n  options: Parameters<typeof importMetaResolve>[1],\n): Result<string> {\n  try {\n    return { error: null, value: importMetaResolve(id, options) };\n  } catch (error) {\n    return { error, value: null };\n  }\n}\n\nfunction resolveStandardizedNameForRequire(\n  type: \"plugin\" | \"preset\",\n  name: string,\n  dirname: string,\n) {\n  const it = resolveAlternativesHelper(type, name);\n  let res = it.next();\n  while (!res.done) {\n    res = it.next(tryRequireResolve(res.value, dirname));\n  }\n  return res.value;\n}\nfunction resolveStandardizedNameForImport(\n  type: \"plugin\" | \"preset\",\n  name: string,\n  dirname: string,\n) {\n  const parentUrl = pathToFileURL(\n    path.join(dirname, \"./babel-virtual-resolve-base.js\"),\n  ).href;\n\n  const it = resolveAlternativesHelper(type, name);\n  let res = it.next();\n  while (!res.done) {\n    res = it.next(tryImportMetaResolve(res.value, parentUrl));\n  }\n  return fileURLToPath(res.value);\n}\n\nfunction resolveStandardizedName(\n  type: \"plugin\" | \"preset\",\n  name: string,\n  dirname: string,\n  resolveESM: boolean,\n) {\n  if (!supportsESM || !resolveESM) {\n    return resolveStandardizedNameForRequire(type, name, dirname);\n  }\n\n  try {\n    const resolved = resolveStandardizedNameForImport(type, name, dirname);\n    // import-meta-resolve 4.0 does not throw if the module is not found.\n    if (!existsSync(resolved)) {\n      throw Object.assign(\n        new Error(`Could not resolve \"${name}\" in file ${dirname}.`),\n        { type: \"MODULE_NOT_FOUND\" },\n      );\n    }\n    return resolved;\n  } catch (e) {\n    try {\n      return resolveStandardizedNameForRequire(type, name, dirname);\n    } catch (e2) {\n      if (e.type === \"MODULE_NOT_FOUND\") throw e;\n      if (e2.type === \"MODULE_NOT_FOUND\") throw e2;\n      throw e;\n    }\n  }\n}\n\nif (!process.env.BABEL_8_BREAKING) {\n  // eslint-disable-next-line no-var\n  var LOADING_MODULES = new Set();\n}\nfunction* requireModule(type: string, name: string): Handler<unknown> {\n  if (!process.env.BABEL_8_BREAKING) {\n    if (!(yield* isAsync()) && LOADING_MODULES.has(name)) {\n      throw new Error(\n        `Reentrant ${type} detected trying to load \"${name}\". This module is not ignored ` +\n          \"and is trying to load itself while compiling itself, leading to a dependency cycle. \" +\n          'We recommend adding it to your \"ignore\" list in your babelrc, or to a .babelignore.',\n      );\n    }\n  }\n\n  try {\n    if (!process.env.BABEL_8_BREAKING) {\n      LOADING_MODULES.add(name);\n    }\n\n    if (process.env.BABEL_8_BREAKING) {\n      return yield* loadCodeDefault(\n        name,\n        `You appear to be using a native ECMAScript module ${type}, ` +\n          \"which is only supported when running Babel asynchronously.\",\n      );\n    } else {\n      return yield* loadCodeDefault(\n        name,\n        `You appear to be using a native ECMAScript module ${type}, ` +\n          \"which is only supported when running Babel asynchronously.\",\n        // For backward compatibility, we need to support malformed presets\n        // defined as separate named exports rather than a single default\n        // export.\n        // See packages/babel-core/test/fixtures/option-manager/presets/es2015_named.js\n        // @ts-ignore(Babel 7 vs Babel 8) This param has been removed\n        true,\n      );\n    }\n  } catch (err) {\n    err.message = `[BABEL]: ${err.message} (While processing: ${name})`;\n    throw err;\n  } finally {\n    if (!process.env.BABEL_8_BREAKING) {\n      LOADING_MODULES.delete(name);\n    }\n  }\n}\n"],"mappings":"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"}