{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import {\n  cloneNode,\n  exportNamedDeclaration,\n  exportSpecifier,\n  identifier,\n  variableDeclaration,\n  variableDeclarator,\n} from \"@babel/types\";\nimport type * as t from \"@babel/types\";\nimport type { NodePath } from \"@babel/traverse\";\n\nexport default function splitExportDeclaration(\n  exportDeclaration: NodePath<\n    t.ExportDefaultDeclaration | t.ExportNamedDeclaration\n  >,\n) {\n  if (\n    !exportDeclaration.isExportDeclaration() ||\n    exportDeclaration.isExportAllDeclaration()\n  ) {\n    throw new Error(\"Only default and named export declarations can be split.\");\n  }\n\n  // build specifiers that point back to this export declaration\n\n  if (exportDeclaration.isExportDefaultDeclaration()) {\n    const declaration = exportDeclaration.get(\"declaration\");\n    const standaloneDeclaration =\n      declaration.isFunctionDeclaration() || declaration.isClassDeclaration();\n    const exportExpr =\n      declaration.isFunctionExpression() || declaration.isClassExpression();\n\n    const scope = declaration.isScope()\n      ? declaration.scope.parent\n      : declaration.scope;\n\n    // @ts-expect-error id is not defined in expressions other than function/class\n    let id = declaration.node.id;\n    let needBindingRegistration = false;\n\n    if (!id) {\n      needBindingRegistration = true;\n\n      id = scope.generateUidIdentifier(\"default\");\n\n      if (standaloneDeclaration || exportExpr) {\n        declaration.node.id = cloneNode(id);\n      }\n    } else if (exportExpr && scope.hasBinding(id.name)) {\n      needBindingRegistration = true;\n\n      id = scope.generateUidIdentifier(id.name);\n    }\n\n    const updatedDeclaration = standaloneDeclaration\n      ? declaration.node\n      : variableDeclaration(\"var\", [\n          variableDeclarator(\n            cloneNode(id),\n            // @ts-expect-error When `standaloneDeclaration` is false, declaration must not be a Function/ClassDeclaration\n            declaration.node,\n          ),\n        ]);\n\n    const updatedExportDeclaration = exportNamedDeclaration(null, [\n      exportSpecifier(cloneNode(id), identifier(\"default\")),\n    ]);\n\n    exportDeclaration.insertAfter(updatedExportDeclaration);\n    exportDeclaration.replaceWith(updatedDeclaration);\n\n    if (needBindingRegistration) {\n      scope.registerDeclaration(exportDeclaration);\n    }\n\n    return exportDeclaration;\n  } else if (\n    // @ts-expect-error TS can not narrow down to NodePath<t.ExportNamedDeclaration>\n    exportDeclaration.get(\"specifiers\").length > 0\n  ) {\n    throw new Error(\"It doesn't make sense to split exported specifiers.\");\n  }\n\n  const declaration = exportDeclaration.get(\"declaration\");\n  const bindingIdentifiers = declaration.getOuterBindingIdentifiers();\n\n  const specifiers = Object.keys(bindingIdentifiers).map(name => {\n    return exportSpecifier(identifier(name), identifier(name));\n  });\n\n  const aliasDeclar = exportNamedDeclaration(null, specifiers);\n\n  exportDeclaration.insertAfter(aliasDeclar);\n  exportDeclaration.replaceWith(declaration.node);\n  return exportDeclaration;\n}\n"],"names":["cloneNode","exportNamedDeclaration","exportSpecifier","identifier","variableDeclaration","variableDeclarator","_t","splitExportDeclaration","exportDeclaration","isExportDeclaration","isExportAllDeclaration","Error","isExportDefaultDeclaration","declaration","get","standaloneDeclaration","isFunctionDeclaration","isClassDeclaration","exportExpr","isFunctionExpression","isClassExpression","scope","isScope","parent","id","node","needBindingRegistration","generateUidIdentifier","hasBinding","name","updatedDeclaration","updatedExportDeclaration","insertAfter","replaceWith","registerDeclaration","length","bindingIdentifiers","getOuterBindingIdentifiers","specifiers","Object","keys","map","aliasDeclar"],"mappings":"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"}